<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vortex Education Portal</title>
    <!-- --- KEEP original GN-Math head assets & analytics intact --- -->
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    <link rel="apple-touch-icon" href="/favicon.png">
    <script>
        window.addEventListener('beforeunload', function (event) {
            event.preventDefault();
            event.returnValue = '';
            return 'Are you sure you want to leave? Any unsaved changes will be lost.';
        });
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5521219086088837" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WX5VS54ZDW"></script>
    <meta name="google-adsense-account" content="ca-pub-5521219086088837">
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){ dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-WX5VS54ZDW');
    </script>
    <script async src="https://fundingchoicesmessages.google.com/i/pub-5521219086088837?ers=1"></script>
    <script>(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
    
    <!-- GN-Math loader (kept) -->
    <script src="https://cdn.jsdelivr.net/gh/gn-math/gn-math.github.io@main/gnmath.js"></script>
    <link rel="stylesheet" href="style.css">
    
    <!-- --- Overlay styling (keeps GN-Math unaffected) --- -->
    <style>
        /* overlay (school cover) sits above everything, removed on unlock */
        #vortex-overlay{
            position:fixed; 
            inset:0; 
            background: linear-gradient(180deg,#f7fbff,#eef6fc); 
            z-index:999999; 
            display:flex; 
            flex-direction:column; 
            font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; 
            color:#123; 
            overflow:auto;
        }
        
        .v-header {
            background:#0a3a86; 
            color:#fff; 
            padding:16px 22px; 
            display:flex; 
            align-items:center; 
            gap:14px; 
            box-shadow: 0 3px 12px rgba(8,25,50,0.12);
        }
        
        .v-logo {
            width:56px;height:56px;border-radius:8px;background:#fff;padding:6px;display:flex;align-items:center;justify-content:center;
        }
        
        .v-title {
            font-size:20px;font-weight:700;letter-spacing:0.2px;
        }
        
        .v-sub {
            color:#cfe4ff; 
            font-size:13px; 
            margin-top:4px;
        }
        
        .v-body {
            display:flex; 
            gap:26px; 
            width:100%; 
            max-width:1200px; 
            margin:24px auto; 
            padding:0 20px; 
            box-sizing:border-box;
        }
        
        .left {
            flex:1; 
            background:#fff;border-radius:12px;padding:20px; 
            box-shadow:0 8px 24px rgba(10,30,60,0.06);
        }
        
        .right {
            width:360px; 
            background:#fff;border-radius:12px;padding:18px; 
            box-shadow:0 8px 24px rgba(10,30,60,0.06);
        }
        
        .section-title {
            margin:0 0 8px 0; 
            font-size:18px; 
            font-weight:700; 
            color:#10243a;
        }
        
        p.lead {
            color:#37566a; 
            line-height:1.45; 
            margin:8px 0 12px;
        }
        
        /* cards */
        .cards {
            display:flex; 
            flex-wrap:wrap; 
            gap:14px; 
            margin-top:12px;
        }
        
        .card {
            width:220px;height:120px;border-radius:10px;padding:12px;background:linear-gradient(180deg,#fff,#fbfdff); 
            box-shadow:0 6px 16px rgba(8,30,60,0.04); 
            display:flex; 
            gap:10px; 
            align-items:center;
        }
        
        .card img {
            width:52px;height:52px; 
            border-radius:8px; 
            object-fit:cover;
        }
        
        /* login box */
        .login-title {
            font-weight:700; 
            margin-bottom:8px; 
            color:#0b3a86;
        }
        
        .input {
            width:100%; 
            padding:10px;border:1px solid #e6eef8;border-radius:8px; 
            margin:8px 0; 
            font-size:14px; 
            box-sizing:border-box;
        }
        
        .btn {
            width:100%; 
            padding:10px;border-radius:8px;border:0; 
            background:#0b61d1; 
            color:#fff; 
            font-weight:700; 
            cursor:pointer;
        }
        
        .btn:hover {
            background:#0955bb;
        }
        
        /* flashcard area inside overlay */
        .flash-wrap {
            margin-top:14px; 
            text-align:center;
        }
        
        .card-face {
            width:100%; 
            height:160px; 
            border-radius:8px; 
            border:1px solid #e6eef8; 
            display:flex; 
            align-items:center; 
            justify-content:center; 
            font-size:20px; 
            background:#fff; 
            padding:12px; 
            box-sizing:border-box;
        }
        
        .controls {
            display:flex; 
            gap:10px; 
            justify-content:center; 
            margin-top:10px;
        }
        
        .overlay-footer {
            text-align:center; 
            padding:18px 10px; 
            color:#526471; 
            font-size:13px;
        }
        
        /* invisible hotspot - tiny and entirely transparent */
        #secret-hotspot {
            position:fixed; 
            width:20px;height:20px; 
            right:6px; 
            bottom:6px; 
            z-index:1000000; 
            opacity:0; 
            pointer-events:auto; 
            cursor:default;
        }
        
        /* GN-Math iframe (kept hidden until unlock) */
        #gn-frame {
            position:fixed; 
            inset:0; 
            width:100%; 
            height:100%; 
            border:0; 
            display:none;
        }
        
        .login-error {
            color: #d73027;
            font-size: 13px;
            margin-top: 8px;
            text-align: center;
            display: none;
        }
        
        @media(max-width:1000px){
            .v-body{
                flex-direction:column; 
                align-items:center;
            }
            .right{
                width:100%; 
                max-width:520px;
            }
        }
    </style>
</head>

<body class="dark-mode">
    <!-- ---------- VORTEX SCHOOL OVERLAY (on top) ---------- -->
    <div id="vortex-overlay" aria-hidden="false">
        <div class="v-header">
            <div class="v-logo"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/School_icon.png" alt="logo" style="width:36px;height:36px;"></div>
            <div>
                <div class="v-title">Vortex Education</div>
                <div class="v-sub">Student Portal — Flashcards · Quizzes · Progress</div>
            </div>
            <div style="flex:1"></div>
            <div style="font-size:13px;color:#cfe0ff">vortex.edu internal</div>
        </div>
        
        <div class="v-body">
            <div class="left">
                <h3 class="section-title">Study tools & highlights</h3>
                <p class="lead">Interactive flashcards, quick quizzes, and short practice sets help students review and retain concepts. This portal supports progress tracking, printable revision sheets and quick review games.</p>
                
                <div class="cards" aria-hidden="true">
                    <div class="card">
                        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135768.png" alt="">
                        <div>
                            <strong>Flashcards — Algebra</strong>
                            <div style="font-size:12px;color:#67798a">120 cards · 5 min</div>
                        </div>
                    </div>
                    <div class="card">
                        <img src="https://cdn-icons-png.flaticon.com/512/747/747310.png" alt="">
                        <div>
                            <strong>Quiz — Fractions</strong>
                            <div style="font-size:12px;color:#67798a">10 Q · timed</div>
                        </div>
                    </div>
                    <div class="card">
                        <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="">
                        <div>
                            <strong>Progress</strong>
                            <div style="font-size:12px;color:#67798a">Weekly streaks & badges</div>
                        </div>
                    </div>
                </div>
                
                <h4 style="margin-top:18px">Sample flashcard</h4>
                <div class="card-face">Q: What is 9 × 6? <br><small style="color:#556879">Click the flashcard panel to show answer</small></div>
            </div>
            
            <aside class="right" aria-hidden="true">
                <div>
                    <div class="login-title">Student login</div>
                    <input id="v-user" class="input" placeholder="Student name or email">
                    <input id="v-password" class="input" type="password" placeholder="Password">
                    <button class="btn" id="loginBtn">Login</button>
                    <div class="login-error" id="loginError">Invalid credentials. Please try again.</div>
                    
                    <div class="flash-wrap" id="flash-wrap" style="display:none;">
                        <div id="card-face" class="card-face" onclick="toggleFlip()">Tap to flip</div>
                        <div class="controls">
                            <button class="btn" style="background:#e6eef8;color:#123;border:0;padding:8px 12px;" onclick="prevCard()">Prev</button>
                            <button class="btn" style="background:#0b61d1;padding:8px 12px;" onclick="nextCard()">Next</button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top:14px; color:#556779; font-size:14px;">
                    <strong>Quick links</strong>
                    <ul style="padding-left:16px; margin-top:8px; color:#556779;">
                        <li>Class announcements</li>
                        <li>Homework planner</li>
                        <li>Library & resources</li>
                    </ul>
                </div>
            </aside>
        </div>
        
        <div class="overlay-footer">Vortex Education • Demo portal</div>
        
        <!-- invisible hotspot — bottom-right tiny clickable area (no text, no cursor change) -->
        <div id="secret-hotspot" aria-hidden="true" title=""></div>
    </div>

    <!-- ---------- ORIGINAL GN-MATH CONTENT (unchanged) ---------- -->
    <header>
        <div class="header-content">
            <div class="logo">gn-math</div>
            <div class="search-container">
                <input type="text" id="searchBar" placeholder="Search zones..." oninput="filterZones()">
                <select id="sortOptions" onchange="sortZones()">
                    <option value="name">Name</option>
                    <option value="id">ID (Date)</option>
                    <option value="popular">Popular</option>
                </select>
            </div>
            <div class="control-buttons">
                <button id="settings" style="background-color: var(--primary-color); color: white; border: none; border-radius: 4px; padding: 0.5rem 1rem; font-size: 16px; cursor: pointer;">Settings</button>
            </div>
        </div>
    </header>

    <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-client="ca-pub-5521219086088837" data-ad-slot="5549138288" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

    <main>
        <details id="featuredZonesWrapper" open>
            <summary id="allZonesSummary" style="font-size: 1.2rem; font-weight: bold; cursor: pointer;">Featured Zones</summary>
            <div id="featuredZones" class="zone-container"></div>
        </details>
        <br><hr><br>
        <details id="allZonesWrapper" open>
            <summary id="allSummary" style="font-size: 1.2rem; font-weight: bold; cursor: pointer;">All Zones</summary>
            <div id="container">Loading...</div>
        </details>
    </main>

    <div id="zoneViewer">
        <div class="zone-header">
            <div class="zone-title">
                <h2 id="zoneName">zone</h2>
                <span id="zoneId" style="display: none;"></span>
                <a id="zoneAuthor" href="#" target="_blank">by Author</a>
            </div>
            <div class="zone-controls">
                <button onclick="fullscreenZone()">Fullscreen</button>
                <button onclick="aboutBlank()">Open in New Tab</button>
                <button onclick="downloadZone()">Download</button>
                <button onclick="closeZone()">Close</button>
            </div>
        </div>
        <!-- Enhanced iframe with better pointer lock and game support -->
        <iframe id="zoneFrame" 
                allow="fullscreen; autoplay; encrypted-media; keyboard; pointer-lock; gamepad; clipboard-read; clipboard-write" 
                sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-modals allow-pointer-lock allow-fullscreen"></iframe>
    </div>

    <div id="popupOverlay">
        <div class="popup">
            <div class="popup-header">
                <h3 id="popupTitle">Title</h3>
                <button id="popupClose" onclick="closePopup()">×</button>
            </div>
            <div id="popupBody">
                Content will be here
            </div>
        </div>
    </div>

    <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-client="ca-pub-5521219086088837" data-ad-slot="5549138288" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

    <footer>
        <div class="footer-links">
            <a href="#" onclick="showContact(); return false;">Contact</a>
            <a href="#" onclick="loadPrivacy(); return false;">Privacy Policy</a>
            <a href="javascript:saveData()">Export Data</a>
            <a href="#" onclick="document.getElementById('importData').click(); return false;">Import Data</a>
            <input type="file" id="importData" style="display: none;" onchange="loadData(event)">
        </div>
    </footer>

    <!-- original GN-Math script (kept as-is) -->
    <script src="script.js"></script>
    <script>
        const search = new URLSearchParams(window.location.search);
        const privacy = search.get('privacy');
        if (privacy) {
            loadPrivacy();
        }
    </script>

    <!-- ---------- VORTEX overlay logic & helpers ---------- -->
    <script>
        // Function to unlock and show GN-Math
        function unlockGNMath() {
            const overlay = document.getElementById('vortex-overlay');
            if(overlay) overlay.style.display = 'none';
            
            // Focus management for better game compatibility
            setTimeout(() => {
                try {
                    const frame = document.getElementById('zoneFrame');
                    if(frame && frame.contentWindow) {
                        frame.contentWindow.focus();
                        // Try to focus the body of the iframe content
                        frame.contentWindow.document.body && frame.contentWindow.document.body.focus();
                    } else {
                        document.body.focus();
                    }
                } catch(e) {
                    console.log('Focus management:', e);
                }
            }, 200);
        }

        // 1) Invisible hotspot: 5 clicks within 2 seconds unlocks GN-Math
        (function(){
            const hotspot = document.getElementById('secret-hotspot');
            const timestamps = [];
            
            hotspot.addEventListener('click', () => {
                const now = Date.now();
                timestamps.push(now);
                
                // keep only recent clicks (last 5)
                while(timestamps.length > 5) timestamps.shift();
                
                if (timestamps.length === 5 && (now - timestamps[0]) <= 2000) {
                    unlockGNMath();
                }
            });
            
            // ensure hotspot is clickable but invisible
            hotspot.style.opacity = 0;
            hotspot.style.pointerEvents = 'auto';
        })();

        // 2) Enhanced login system with secret credentials
        (function(){
            const loginBtn = document.getElementById('loginBtn');
            const flashWrap = document.getElementById('flash-wrap');
            const cardFace = document.getElementById('card-face');
            const loginError = document.getElementById('loginError');
            const userInput = document.getElementById('v-user');
            const passwordInput = document.getElementById('v-password');
            
            // sample cards
            const cards = [
                {q:"What is 8 × 7?", a:"56"},
                {q:"Square root of 121?", a:"11"},
                {q:"Capital of Japan?", a:"Tokyo"},
                {q:"Derivative of x^2?", a:"2x"},
                {q:"What is 15 ÷ 3?", a:"5"},
                {q:"What is π approximately?", a:"3.14159"}
            ];
            
            let idx = 0, flipped = false;
            
            function render(){
                if(!cardFace) return;
                cardFace.innerHTML = flipped ? 
                    ("<strong>A:</strong> " + cards[idx].a) : 
                    ("<strong>Q:</strong> " + cards[idx].q);
            }
            
            function toggleFlip(){
                flipped = !flipped; 
                render();
            }
            
            function nextCard(){
                idx = (idx + 1) % cards.length; 
                flipped = false; 
                render();
            }
            
            function prevCard(){
                idx = (idx - 1 + cards.length) % cards.length; 
                flipped = false; 
                render();
            }
            
            // expose to global (so the inline buttons work)
            window.toggleFlip = toggleFlip;
            window.nextCard = nextCard;
            window.prevCard = prevCard;
            
            // Enhanced login with secret credentials
            loginBtn && loginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                
                const username = userInput.value.trim();
                const password = passwordInput.value.trim();
                
                // Check for secret credentials
                if (username.toLowerCase() === 'artem' && password === 'da goat') {
                    // Secret login - unlock GN-Math
                    unlockGNMath();
                    return;
                }
                
                // Regular login - show flashcards or error
                if (username.length > 0) {
                    // Hide any previous error
                    loginError.style.display = 'none';
                    
                    // Show flashcards (fake login success)
                    flashWrap.style.display = 'block';
                    
                    // Store "session" locally (demo)
                    try {
                        localStorage.setItem('vortex_user', username);
                        localStorage.setItem('vortex_password', password);
                    } catch(e){}
                    
                    render();
                } else {
                    // Show error for empty username
                    loginError.style.display = 'block';
                }
            });
            
            // Allow Enter key to login
            [userInput, passwordInput].forEach(input => {
                input && input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        loginBtn.click();
                    }
                });
            });
            
            // Prefill if saved (except password for security)
            try {
                const u = localStorage.getItem('vortex_user') || '';
                if(u && userInput) userInput.value = u;
            } catch(e){}
        })();

        // 3) Enhanced fullscreen & keyboard helper with better game support
        (function(){
            // Better pointer lock support
            function requestPointerLock(element) {
                if (element.requestPointerLock) {
                    element.requestPointerLock();
                } else if (element.mozRequestPointerLock) {
                    element.mozRequestPointerLock();
                } else if (element.webkitRequestPointerLock) {
                    element.webkitRequestPointerLock();
                }
            }
            
            // Enhanced focus management for games
            function focusGameFrame() {
                const frame = document.getElementById('zoneFrame');
                if (!frame) return;
                
                try {
                    // Focus the iframe itself
                    frame.focus();
                    
                    // Try to focus the content window
                    if (frame.contentWindow) {
                        frame.contentWindow.focus();
                        
                        // Try to focus the document body
                        setTimeout(() => {
                            try {
                                if (frame.contentWindow.document && frame.contentWindow.document.body) {
                                    frame.contentWindow.document.body.focus();
                                }
                                
                                // For canvas games, try to focus the canvas element
                                const canvas = frame.contentWindow.document.querySelector('canvas');
                                if (canvas) {
                                    canvas.focus();
                                    // Enable pointer lock on the canvas for games like Eaglercraft
                                    canvas.addEventListener('click', () => {
                                        requestPointerLock(canvas);
                                    });
                                }
                            } catch(e) {
                                console.log('Canvas focus setup:', e);
                            }
                        }, 100);
                    }
                } catch(e) {
                    console.log('Frame focus error:', e);
                }
            }
            
            // Handle fullscreen changes
            document.addEventListener('fullscreenchange', () => {
                const el = document.fullscreenElement;
                const frame = document.getElementById('zoneFrame');
                
                if (el && frame && (el === frame || frame.contains(el))) {
                    // Delay to ensure browser finished fullscreen transition
                    setTimeout(focusGameFrame, 150);
                }
            });
            
            // Handle pointer lock changes
            document.addEventListener('pointerlockchange', () => {
                setTimeout(focusGameFrame, 50);
            });
            
            // Enhanced iframe load handler
            const frame = document.getElementById('zoneFrame');
            if (frame) {
                frame.addEventListener('load', () => {
                    setTimeout(() => {
                        focusGameFrame();
                        
                        // Set up game-specific enhancements
                        try {
                            const iframeDoc = frame.contentWindow.document;
                            
                            // Look for game canvas and enhance it
                            const canvas = iframeDoc.querySelector('canvas');
                            if (canvas) {
                                // Add pointer lock support
                                canvas.addEventListener('click', (e) => {
                                    if (document.pointerLockElement !== canvas) {
                                        requestPointerLock(canvas);
                                    }
                                });
                                
                                // Ensure canvas can receive focus
                                canvas.tabIndex = 0;
                                
                                // Add keyboard event listeners to canvas
                                canvas.addEventListener('keydown', (e) => {
                                    e.stopPropagation();
                                });
                                
                                canvas.addEventListener('keyup', (e) => {
                                    e.stopPropagation();
                                });
                            }
                            
                            // Focus management for the iframe document
                            iframeDoc.addEventListener('click', focusGameFrame);
                            
                        } catch(e) {
                            console.log('Game enhancement setup:', e);
                        }
                    }, 500);
                });
            }
            
            // Global escape key handler
            document.addEventListener('keydown', (ev) => {
                if (ev.key === 'Escape') {
                    if (document.fullscreenElement) {
                        document.exitFullscreen().catch(() => {});
                    }
                    if (document.pointerLockElement) {
                        document.exitPointerLock();
                    }
                }
            });
            
            // Prevent context menu in game area (common for games)
            document.addEventListener('contextmenu', (e) => {
                const frame = document.getElementById('zoneFrame');
                if (frame && e.target === frame) {
                    e.preventDefault();
                }
            });
        })();
    </script>
</body>
</html>
