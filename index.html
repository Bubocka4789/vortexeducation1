<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vortex Education Portal</title>

<!-- keep icons / analytics from original -->
<link rel="icon" type="image/png" href="favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
<link rel="apple-touch-icon" href="/favicon.png">

<script>
  window.addEventListener('beforeunload', function (event) {
    event.preventDefault();
    event.returnValue = '';
    return 'Are you sure you want to leave? Any unsaved changes will be lost.';
  });
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5521219086088837" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WX5VS54ZDW"></script>
<meta name="google-adsense-account" content="ca-pub-5521219086088837">
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-WX5VS54ZDW');
</script>
<script async src="https://fundingchoicesmessages.google.com/i/pub-5521219086088837?ers=1"></script>
<script>(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>

<!-- GN-Math loader kept -->
<script src="https://cdn.jsdelivr.net/gh/gn-math/gn-math.github.io@main/gnmath.js"></script>
<link rel="stylesheet" href="style.css">

<style>
  /* ---------- Overlay (Vortex school) styling ---------- */
  :root { --blue:#0b61d1; --muted:#6b7886; --panel:#ffffff; --bg:#f4f7fb; }
  html,body { height:100%; margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial; background:var(--bg); }
  #vortex-overlay {
    position:fixed; inset:0; z-index:999999; background: linear-gradient(180deg,#f7fbff,#eef6fc);
    display:flex; flex-direction:column; align-items:center; overflow:auto;
  }
  .v-header { width:100%; background:#0a3a86; color:#fff; padding:14px 22px; display:flex; align-items:center; gap:14px; box-shadow:0 3px 12px rgba(8,25,50,0.12);}
  .v-logo { width:56px; height:56px; border-radius:8px; background:#fff; padding:6px; display:flex; align-items:center; justify-content:center; }
  .v-title { font-size:20px; font-weight:700; }
  .v-sub { color:#cfe4ff; font-size:13px; margin-top:4px;}
  .v-body { width:100%; max-width:1200px; display:flex; gap:24px; margin:22px; padding:0 12px; box-sizing:border-box; }
  .left { flex:1; background:var(--panel); border-radius:12px; padding:18px; box-shadow:0 8px 24px rgba(10,30,60,0.06); }
  .right { width:360px; background:var(--panel); border-radius:12px; padding:18px; box-shadow:0 8px 24px rgba(10,30,60,0.06); }
  .section-title { font-size:18px; color:#10243a; margin:0 0 8px 0; }
  p.lead { color:var(--muted); line-height:1.45; margin:6px 0 12px; }
  .cards { display:flex; gap:12px; flex-wrap:wrap; }
  .card { width:220px; height:120px; border-radius:10px; padding:12px; background:linear-gradient(180deg,#fff,#fbfdff); box-shadow:0 6px 16px rgba(8,30,60,0.04); display:flex; gap:10px; align-items:center;}
  .card img { width:52px; height:52px; border-radius:8px; object-fit:cover; }

  /* login */
  .login-title { font-weight:700; color:var(--blue); font-size:15px; margin-bottom:8px; }
  .input { width:100%; padding:10px; border:1px solid #e6eef8; border-radius:8px; margin:8px 0; }
  .btn { width:100%; padding:10px; border-radius:8px; border:0; background:var(--blue); color:#fff; font-weight:700; cursor:pointer; }
  .btn.ghost { background:transparent; color:var(--blue); border:1px solid #e6eef8; font-weight:600; }

  .flash-wrap { margin-top:14px; text-align:center; }
  .card-face { width:100%; height:160px; border-radius:8px; border:1px solid #e6eef8; display:flex; align-items:center; justify-content:center; font-size:18px; background:#fff; padding:12px; box-sizing:border-box; cursor:pointer; }
  .controls { display:flex; gap:10px; justify-content:center; margin-top:10px; }

  .overlay-footer { text-align:center; padding:12px 8px; color:#526471; font-size:13px; }

  /* secret hotspot (invisible) */
  #secret-hotspot { position:fixed; width:22px; height:22px; right:6px; bottom:6px; z-index:1000000; opacity:0; pointer-events:auto; cursor:default; }

  /* reveal button for logged-in users */
  #reveal-btn { margin-top:10px; display:none; }

  /* responsive */
  @media(max-width:1000px) { .v-body { flex-direction:column; align-items:center; } .right { width:100%; max-width:520px; } }

  /* flashcard animation */
  .flip-wrap { perspective:1000px; width:100%; }
  .flip-card { width:100%; height:160px; position:relative; transform-style:preserve-3d; transition:transform .55s; }
  .flip-card.flipped { transform:rotateY(180deg); }
  .flip-card .face { position:absolute; inset:0; backface-visibility:hidden; border-radius:8px; display:flex; align-items:center; justify-content:center; padding:12px; box-sizing:border-box; }
  .flip-card .back { transform:rotateY(180deg); }

  /* GN-Math content (original) - when unlocked we reveal GN-Math zoneFrame */
  #zoneFrame { display:none; width:100%; height:100%; border:0; position:fixed; inset:0; }

  /* small helper message */
  #pointer-help { font-size:13px; color:#4b5563; margin-top:8px; }
</style>
</head>
<body class="dark-mode">

<!-- ---------- VORTEX school overlay ---------- -->
<div id="vortex-overlay" aria-hidden="false">
  <div class="v-header">
    <div class="v-logo"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/School_icon.png" alt="logo" style="width:36px;height:36px;"></div>
    <div>
      <div class="v-title">Vortex Education</div>
      <div class="v-sub">Student Portal — Flashcards · Quizzes · Progress</div>
    </div>
    <div style="flex:1"></div>
    <div style="font-size:13px;color:#cfe0ff">vortex.edu internal</div>
  </div>

  <div class="v-body">
    <div class="left">
      <h3 class="section-title">Study tools & highlights</h3>
      <p class="lead">Interactive flashcards and short quizzes to help students review and retain concepts. Practice sets, progress tracking, and printable revision sheets are available.</p>

      <div class="cards" aria-hidden="true">
        <div class="card">
          <img src="https://cdn-icons-png.flaticon.com/512/3135/3135768.png" alt="">
          <div>
            <strong>Flashcards — Algebra</strong>
            <div style="font-size:12px;color:#67798a">120 cards · 5 min</div>
          </div>
        </div>

        <div class="card">
          <img src="https://cdn-icons-png.flaticon.com/512/747/747310.png" alt="">
          <div>
            <strong>Quiz — Fractions</strong>
            <div style="font-size:12px;color:#67798a">10 Q · timed</div>
          </div>
        </div>

        <div class="card">
          <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="">
          <div>
            <strong>Progress</strong>
            <div style="font-size:12px;color:#67798a">Weekly streaks & badges</div>
          </div>
        </div>
      </div>

      <h4 style="margin-top:18px">Sample flashcard</h4>
      <div class="card-face">Q: What is 9 × 6? <br><small style="color:#556879">Click the flashcard panel to show answer</small></div>
    </div>

    <aside class="right" aria-hidden="true">
      <div>
        <div class="login-title">Student login</div>
        <input id="v-user" class="input" placeholder="Student name or email">
        <input id="v-school" class="input" placeholder="School name">
        <button class="btn" id="loginBtn">Login</button>

        <div class="flash-wrap" id="flash-wrap" style="display:none;">
          <div class="flip-wrap">
            <div id="flipCard" class="flip-card">
              <div class="face front" id="cardFront">Tap to reveal</div>
              <div class="face back" id="cardBack">Answer</div>
            </div>
          </div>

          <div class="controls" style="margin-top:10px;">
            <button class="btn ghost" onclick="prevCard()">Prev</button>
            <button class="btn" onclick="nextCard()">Next</button>
          </div>

          <div id="pointer-help" style="margin-top:10px;">
            After you open a game, click the game area once to enable mouse-lock if it doesn't lock automatically.
          </div>

          <button id="reveal-btn" class="btn" onclick="unlockByButton()">Reveal Games</button>
        </div>
      </div>

      <div style="margin-top:14px; color:#556779; font-size:14px;">
        <strong>Quick links</strong>
        <ul style="padding-left:16px; margin-top:8px; color:#556779;">
          <li>Class announcements</li>
          <li>Homework planner</li>
          <li>Library & resources</li>
        </ul>
      </div>
    </aside>
  </div>

  <div class="overlay-footer">Vortex Education • Demo portal</div>

  <!-- invisible hotspot — bottom-right tiny clickable area (no text) -->
  <div id="secret-hotspot" aria-hidden="true" title=""></div>
</div>

<!-- ---------- ORIGINAL GN-MATH CONTENT (kept as before) ---------- -->
<header>
    <div class="header-content">
        <div class="logo">gn-math</div>
        <div class="search-container">
            <input type="text" id="searchBar" placeholder="Search zones..." oninput="filterZones()">
            <select id="sortOptions" onchange="sortZones()">
                <option value="name">Name</option>
                <option value="id">ID (Date)</option>
                <option value="popular">Popular</option>
            </select>
        </div>
        <div class="control-buttons">
            <button id="settings" style="background-color: var(--primary-color); color: white; border: none; border-radius: 4px; padding: 0.5rem 1rem; font-size: 16px; cursor: pointer;">Settings</button>
        </div>
    </div>
</header>

<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-client="ca-pub-5521219086088837" data-ad-slot="5549138288" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

<main>
    <details id="featuredZonesWrapper" open>
        <summary id="allZonesSummary" style="font-size: 1.2rem; font-weight: bold; cursor: pointer;">Featured Zones</summary>
        <div id="featuredZones" class="zone-container"></div>
    </details>
    <br><hr><br>
    <details id="allZonesWrapper" open>
        <summary id="allSummary" style="font-size: 1.2rem; font-weight: bold; cursor: pointer;">All Zones</summary>
        <div id="container">Loading...</div>
    </details>
</main>

<div id="zoneViewer">
    <div class="zone-header">
        <div class="zone-title">
            <h2 id="zoneName">zone</h2>
            <span id="zoneId" style="display: none;"></span>
            <a id="zoneAuthor" href="#" target="_blank">by Author</a>
        </div>
        <div class="zone-controls">
            <button onclick="fullscreenZone()">Fullscreen</button>
            <button onclick="aboutBlank()">Open in New Tab</button>
            <button onclick="downloadZone()">Download</button>
            <button onclick="closeZone()">Close</button>
        </div>
    </div>

    <!-- zoneFrame accepts allow & sandbox to increase chance pointer-lock works -->
    <iframe id="zoneFrame" allow="fullscreen; autoplay; encrypted-media; keyboard; pointer-lock; gamepad" sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-modals"></iframe>
</div>

<div id="popupOverlay">
    <div class="popup">
        <div class="popup-header">
            <h3 id="popupTitle">Title</h3>
            <button id="popupClose" onclick="closePopup()">×</button>
        </div>
        <div id="popupBody"> Content will be here </div>
    </div>
</div>

<ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-client="ca-pub-5521219086088837" data-ad-slot="5549138288" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

<footer>
    <div class="footer-links">
        <a href="#" onclick="showContact(); return false;">Contact</a>
        <a href="#" onclick="loadPrivacy(); return false;">Privacy Policy</a>
        <a href="javascript:saveData()">Export Data</a>
        <a href="#" onclick="document.getElementById('importData').click(); return false;">Import Data</a>
        <input type="file" id="importData" style="display: none;" onchange="loadData(event)">
    </div>
</footer>

<!-- original GN-Math script -->
<script src="script.js"></script>
<script>
const search = new URLSearchParams(window.location.search);
const privacy = search.get('privacy');
if (privacy) { loadPrivacy(); }
</script>

<!-- ---------- Overlay & feature scripts ---------- -->
<script>
/* ---------- Secret hotspot unlock: 5 clicks in 2s ---------- */
(function() {
  const hotspot = document.getElementById('secret-hotspot');
  let times = [];
  hotspot.addEventListener('click', () => {
    const now = Date.now();
    times.push(now);
    // keep only last 6
    if (times.length > 6) times.shift();
    // check last 5 within 2s
    if (times.length >= 5 && (now - times[times.length - 5]) <= 2000) {
      unlockPortal();
    }
  });
  // make sure hotspot clickable
  hotspot.style.pointerEvents = 'auto';
})();

/* ---------- Login & flashcards ---------- */
(function() {
  const loginBtn = document.getElementById('loginBtn');
  const flashWrap = document.getElementById('flash-wrap');
  const flipCard = document.getElementById('flipCard');
  const front = document.getElementById('cardFront');
  const back = document.getElementById('cardBack');
  const revealBtn = document.getElementById('reveal-btn');

  // bigger set of flashcards (sample)
  const cards = [
    {q:"What is 7 × 8?", a:"56"},
    {q:"Square root of 144?", a:"12"},
    {q:"Capital of Italy?", a:"Rome"},
    {q:"Derivative of x^3?", a:"3x²"},
    {q:"H2O is the chemical formula for?", a:"Water"},
    {q:"What is 9²?", a:"81"},
    {q:"What is 15 + 27?", a:"42"},
    {q:"How many degrees in a triangle?", a:"180°"},
    {q:"What planet is known as the Red Planet?", a:"Mars"},
    {q:"What is 2³?", a:"8"},
    {q:"Who wrote 'Hamlet'?", a:"William Shakespeare"},
    {q:"What is the freezing point of water (°C)?", a:"0°C"},
    {q:"What is the largest mammal?", a:"Blue whale"},
    {q:"What is 11 × 11?", a:"121"},
    {q:"What gas do plants absorb?", a:"Carbon dioxide (CO₂)"},
    {q:"What is 100 ÷ 4?", a:"25"},
    {q:"What is 8 × 6?", a:"48"},
    {q:"What is the capital of Spain?", a:"Madrid"},
    {q:"What is 14 - 5?", a:"9"},
    {q:"What is the main language of Brazil?", a:"Portuguese"},
    {q:"What is 3 × 7?", a:"21"},
    {q:"What is 10²?", a:"100"},
    {q:"Who discovered gravity?", a:"Isaac Newton"},
    {q:"What is the chemical symbol for gold?", a:"Au"},
    {q:"What is 6 × 6?", a:"36"},
    {q:"What is the capital of Germany?", a:"Berlin"},
    {q:"What is the square root of 64?", a:"8"},
    {q:"What is 5 + 12?", a:"17"},
    {q:"What is the fastest land animal?", a:"Cheetah"},
    {q:"What is 4³?", a:"64"}
  ];

  let idx = 0, flipped = false;

  function renderCard() {
    front.innerHTML = "<strong>Q:</strong> " + cards[idx].q;
    back.innerHTML = "<strong>A:</strong> " + cards[idx].a;
    flipCard.classList.remove('flipped');
    flipped = false;
  }

  window.toggleFlip = function() {
    flipped = !flipped;
    if (flipped) flipCard.classList.add('flipped'); else flipCard.classList.remove('flipped');
  };
  window.nextCard = function() { idx = (idx + 1) % cards.length; renderCard(); };
  window.prevCard = function() { idx = (idx - 1 + cards.length) % cards.length; renderCard(); };

  loginBtn && loginBtn.addEventListener('click', (e) => {
    e.preventDefault();
    const user = (document.getElementById('v-user').value || '').trim();
    const pass = (document.getElementById('v-school').value || '').trim();
    // fake auth: username 'artem' and password 'the goat' allow immediate reveal
    if (user === 'artem' && pass === 'the goat') {
      try { localStorage.setItem('vortex_user', user); } catch(e){}
      flashWrap.style.display = 'block';
      revealBtn.style.display = 'block';
    } else {
      // normal login just shows flashcards, but reveal button hidden unless correct creds
      flashWrap.style.display = 'block';
      revealBtn.style.display = 'none';
    }
    renderCard();
  });

  // unlock by the reveal button (for correct login)
  window.unlockByButton = function() { unlockPortal(); };

  // prefill saved user (if any)
  try {
    const saved = localStorage.getItem('vortex_user') || '';
    if (saved) document.getElementById('v-user').value = saved;
  } catch(e){}
})();

/* ---------- Unlock function shows GN-Math and attempts to restore focus + pointer lock ---------- */
function unlockPortal() {
  const overlay = document.getElementById('vortex-overlay');
  if (!overlay) return;
  overlay.style.display = 'none';

  // Show GN-Math iframe if script relies on zoneFrame
  const zoneFrame = document.getElementById('zoneFrame');
  if (zoneFrame) zoneFrame.style.display = 'block';

  // Focus the frame (best-effort)
  setTimeout(()=> {
    try {
      if (zoneFrame && zoneFrame.contentWindow) zoneFrame.contentWindow.focus();
      else document.body.focus();
    } catch(e) {}
  }, 150);
}

/* ---------- Pointer lock & fullscreen helpers ---------- */
(function() {
  const zoneFrame = document.getElementById('zoneFrame');

  function tryRequestPointerLockOnFrame() {
    // Many browsers allow pointer lock requested on the iframe element itself (best-effort).
    try {
      if (!zoneFrame) return;
      if (document.pointerLockElement === zoneFrame) return;
      if (zoneFrame.requestPointerLock) {
        zoneFrame.requestPointerLock();
        return;
      }
      // If iframe is same-origin, attempt inside contentDocument
      try {
        const cw = zoneFrame.contentWindow;
        if (cw && cw.document) {
          // attempt to request pointer lock on body inside iframe
          const body = cw.document.body;
          if (body && body.requestPointerLock) body.requestPointerLock();
        }
      } catch(e){}
    } catch(e){}
  }

  // When user enters fullscreen, try to lock pointer for the iframe area
  document.addEventListener('fullscreenchange', () => {
    try {
      const fsEl = document.fullscreenElement;
      // if the zoneFrame is fullscreen or overlay hidden and full viewport likely used,
      // attempt pointer lock
      if (fsEl && (fsEl === zoneFrame || (zoneFrame && zoneFrame.contains(fsEl)))) {
        // delay a little to ensure fullscreen entered
        setTimeout(() => {
          tryRequestPointerLockOnFrame();
          // attempt to focus iframe for keyboard
          if (zoneFrame && zoneFrame.contentWindow) {
            try { zoneFrame.contentWindow.focus(); } catch(e) {}
          }
        }, 120);
      }
    } catch(e){}
  });

  // When user clicks in the page and zoneFrame is visible, attempt to request pointer lock (user gesture).
  document.addEventListener('click', (ev) => {
    try {
      if (!zoneFrame) return;
      const rect = zoneFrame.getBoundingClientRect();
      // if the click is inside the iframe bounds OR forked site is same-origin and frame visible
      const x = ev.clientX, y = ev.clientY;
      if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
        // user clicked the iframe — try to pointer lock
        tryRequestPointerLockOnFrame();
        // also focus iframe for keyboard
        try { zoneFrame.contentWindow && zoneFrame.contentWindow.focus(); } catch(e){}
      }
    } catch(e){}
  });

  // pointerlockchange: attempt to refocus game area when pointerlock acquired
  document.addEventListener('pointerlockchange', () => {
    try {
      if (document.pointerLockElement === zoneFrame) {
        try { zoneFrame.contentWindow.focus(); } catch(e){}
      }
    } catch(e){}
  });

  // pointerlockerror: inform user (best-effort). If it errors, user must click inside the game to enable lock.
  document.addEventListener('pointerlockerror', () => {
    // silent; optionally you could show a toast advising user to click the game canvas
    console.warn('Pointer lock failed — maybe cross-origin or browser denied it. Click inside the game to try again.');
  });

  // Also try to request pointer lock when the page receives a postMessage from game asking for it
  window.addEventListener('message', (evt) => {
    // Listen for an explicit "requestPointerLock" message from same-origin game (optional)
    try {
      if (evt && evt.data && evt.data === 'requestPointerLock') {
        tryRequestPointerLockOnFrame();
      }
    } catch(e){}
  });
})();

/* ---------- Helpful note in console for debugging pointer lock issues ---------- */
console.log('Vortex overlay loaded. Secret hotspot is bottom-right 20×20px. Login with (artem / the goat) to show reveal button. If pointer lock does not work, ensure games are hosted same-origin or click inside the game canvas to allow pointer lock.');
</script>
</body>
</html>
